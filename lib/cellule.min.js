!function(t,n){"function"==typeof define&&define.amd?define(function(){return n(t)}):"object"==typeof module&&module.exports?module.exports=n(this):t.cellule=n(t)}(this,function(t,n){var r=function(t){return"object"==typeof t},e=function(t){return"function"==typeof t},i=function(t){return"string"==typeof t||t instanceof String},o={transition:function(){throw new Error("Don't call transition during cellule object construction")},overrideTransition:function(){throw new Error("Don't call overrideTransition during cellule object construction")},input:function(){throw new Error("Don't call input during cellule object construction")}},a=function(t,r,e,i){if(t[r]!==n)throw new Error(["Cannot redefine",r,"on",i].join(" "));t[r]=e},u=function(){var t=[],e=[],i={},o={},u=null,c=function(n){var r=[{name:n,handlers:[]}];return t.push([r]),{and:function(t){return r.push({name:t,handlers:[]}),this},onEnter:function(t){return r.forEach(function(n){n.onEnter=t}),this},onExit:function(t){return r.forEach(function(n){n.onExit=t}),this},defaultHandler:function(t){return r.forEach(function(n){n["default"]=t}),this},handle:function(t){var n=this,e=[{input:t}];return{and:function(t){return e.push({input:t}),this},"with":function(t){return e.forEach(function(n){n.op=t,r.forEach(function(t){t.handlers.push(n)})}),n}}},setAsInitialState:function(){if(r.length>1)throw new Error("Cannot set two states as the initial state");if(null!==u)throw new Error("Initial state has already been set");u=r[0].name}}},f=function(t){var n=[{name:t}];return e.push(n),{and:function(t){return n.push({name:t}),this},shouldActivate:function(t){return n.forEach(function(n){a(n,"shouldActivate",t,"input: "+n.name)}),this},onActivate:function(t){return n.forEach(function(n){a(n,"onActivate",t,"input: "+n.name)}),this}}},s=function(){if(t.forEach(function(t){t.forEach(function(t){t.forEach(function(t){i[t.name]===n&&(i[t.name]={name:t.name,handlers:{}});var r=i[t.name];t["default"]!==n&&a(r,"default",t["default"],"state: "+t.name),t.onEnter!==n&&a(r,"onEnter",t.onEnter,"state: "+t.name),t.onExit!==n&&a(r,"onExit",t.onExit,"state: "+t.name),t.handlers.forEach(function(r){console.log(JSON.stringify(r)),i[t.name].handlers[r.input]=r.op,o[r.input]===n&&(o[r.input]={name:r.input})})})})}),e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){if(o[t.name]===n&&(o[t.name]={name:t.name}),t.shouldActivate!==n){if(o[t.name].shouldActivate!==n)throw new Error('Cannot redefine "shouldActivate" handler on input: '+t.name);o[t.name].shouldActivate=t.shouldActivate}if(t.onActivate!==n){if(o[t.name]!==n)throw new Error('Cannot redefine "onActivate" handler on input: '+t.name);o[t.name].onActivate=t.onActivate}})})}),!r(i[u]))throw new Error("An initial state must be declared");return{states:i,inputs:o,initialState:i[u]}};return{forState:c,forInput:f,unpackConstructorArrays:s}},c=function(t){if(t._states!==n)throw new Error("");if(t._inputs!==n)throw new Error("");if(t.on!==n)throw new Error("");if(t.transition!==o.transition)throw new Error("");if(t.overrideTransition!==o.overrideTransition)throw new Error("");if(t.input!==o.input)throw new Error("");var r=t.defaultHandler;if(r!==n&&!e(r))throw new Error("");var i=t.beforeTransition;if(i!==n&&!e(i))throw new Error("")},f={create:function(t){if(!r(t))throw new Error("Must provide a params object as the first argument");if(t.init===n)throw new Error('Must provide an initializer function as property "init"');if(!e(t.init))throw new Error("Init property must be a function");var a=u(),f={state:a.forState,input:a.forInput},s={transition:o.transition,overrideTransition:o.overrideTransition,input:o.input,"for":f};t.init.call(s),c(s),s.input=function(t,r){var o=r,a=s._inputs[t];if(a!==n){if(a.shouldActivate!==n&&!a.shouldActivate(o))return;a.onActivate!==n&&a.onActivate(o)}var u=s._currentState.handlers[t],c=s._currentState["default"];u!==n?e(u)?u(o):i(u)&&s.transition(u):c!==n&&c(o)},s.transition=function(t){if(s._states[t]!==n){var r=s._currentState;s._currentState=s._states[t],s._currentState.onEnter!==n&&s._currentState.onEnter(),r.onExit!==n&&r.onExit()}};var h=a.unpackConstructorArrays();s._currentState=h.initialState,s._states=h.states,s._inputs=h.inputs,s.on={};for(var l in s._inputs)s.on[l]=function(t){s.input(l,t)};return s},hasState:function(t,e){if(!r(t)||!r(t._states))throw new Error("Must provide a cellule object");if(!i(e))throw new Error("Must provide a state name");return t._states[e]!==n},hasInput:function(t,e){if(!r(t)||!r(t._states))throw new Error("Must provide a cellule object");if(!i(e))throw new Error("Must provide a state name");return t._inputs[e]!==n},getCurrentStateName:function(t){return t._currentState.name}};return f});