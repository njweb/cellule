var isObj=function(t){return"object"==typeof t},isFunc=function(t){return"function"==typeof t},isString=function(t){return"string"==typeof t||t instanceof String},isState=function(t){return isObj(t)&&isObj(t._handlers)},isInput=function(t){return isObj(t)&&t._name&&isFunc(t.activate)},cellule={createFsm:function(t){var n={};if(isFunc(t)){n._inputs=[];var i=function(t){return cellule.createInput(t)},e=function(t){isString(t)?n._inputs.push(i(t)):isString(_input._name)&&isFunc(t.activate)&&n._inputs.push(t)};n.addInput=function(t){return void 0!==t&&(Array.isArray(t)?t.forEach(function(t){e(t)}):e(t)),t},n.addInputs=n.addInput,t.apply(n),n.on={},n._inputs.forEach(function(t){if(void 0!==n.on[t.getName])throw new Error("Cannot install the same input twice");n.on[t.getName()]=function(){var i=t;return function(t){var e=i.activate(t);return n.input(e.input,e.msg)}}()}),delete n._inputs,delete n.addInput}else isState(t)&&(n.initialState=t);if(isState(n.initialState)?n._currentState=n.initialState:n._currentState=null,void 0!==n.input)throw new Error("Cannot redefine input property on the fsm");if(void 0!==n.transition)throw new Error("Cannot redefine transition property on the fsm");return n.input=function(t,n){if(this._currentState){var i=this._currentState._handlers[t],e=this._currentState._default;return isFunc(i)?i.call(this,n):isFunc(e)?e.call(this,n):void 0}},n.transition=function(t){if(!isState(t))throw new Error("Must provide a state object to transition to");var n=this._currentState;this._currentState=t,isFunc(n._exit)&&n._exit.call(this,t),isFunc(t._enter)&&t._enter.call(this,n)},n.getCurrentState=function(){return this._currentState},n},createState:function(t){return{name:t,_handlers:{},handler:function(t,n){if(t&&isFunc(n)){t.toString();this._handlers[t]=n}else if(isState(n)){t.toString();this._handlers[t]=function(){this.transition(n)}}return this},"default":function(t){return"function"==typeof t&&(this._default=t),this},onEnter:function(t){return"function"==typeof t&&(this._enter=t),this},onExit:function(t){return"function"==typeof t&&(this._exit=t),this},getName:function(){return this.name},toString:function(){return"cellule state: "+this.getName()}}},createInput:function(t){if(!isString(t))throw new TypeError("Input name must be a string");return new function(){this._name=t,this.activate=function(t){return this._validate&&!this._validate(t)?null:(this._transform&&(t=this._transform(t)),{input:this._name,msg:t})},this.getName=function(){return this._name},this.toString=function(){return this.getName()},this.validateMsg=function(t){return isFunc(t)&&(this._validate=t),this},this.transformMsg=function(t){return isFunc(t)&&(this._transform=t),this}}}};module.exports=cellule;