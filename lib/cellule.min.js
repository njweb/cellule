!function(t,n){"function"==typeof define&&define.amd?define(["exports"],function(e){n(t.commonJsStrictGlobal=e)}):n("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:t.commonJsStrictGlobal={})}(this,function(t){var n=function(t){return"object"==typeof t},e=function(t){return"function"==typeof t},i=function(t){return"string"==typeof t||t instanceof String},r=function(t){return n(t)&&n(t._handlers)},o={createFsm:function(t){var n={};if(e(t)){n._inputs=[];var u=function(t){return o.createInput(t)},a=function(t){i(t)?n._inputs.push(u(t)):i(_input._name)&&e(t.activate)&&n._inputs.push(t)};n.addInput=function(t){return void 0!==t&&(Array.isArray(t)?t.forEach(function(t){a(t)}):a(t)),t},n.addInputs=n.addInput,t.apply(n),n.on={},n._inputs.forEach(function(t){if(void 0!==n.on[t.getName])throw new Error("Cannot install the same input twice");n.on[t.getName()]=function(){var e=t;return function(t){var i=e.activate(t);return n.input(i.input,i.msg)}}()}),delete n._inputs,delete n.addInput}else r(t)&&(n.initialState=t);if(r(n.initialState)?n._currentState=n.initialState:n._currentState=null,void 0!==n.input)throw new Error("Cannot redefine input property on the fsm");if(void 0!==n.transition)throw new Error("Cannot redefine transition property on the fsm");return n.input=function(t,n){if(this._currentState){var i=this._currentState._handlers[t],r=this._currentState._default;return e(i)?i.call(this,n):e(r)?r.call(this,n):void 0}},n.transition=function(t){if(!r(t))throw new Error("Must provide a state object to transition to");var n=this._currentState;this._currentState=t,e(n._exit)&&n._exit.call(this,t),e(t._enter)&&t._enter.call(this,n)},n.getCurrentState=function(){return this._currentState},n},createState:function(t){return{name:t,_handlers:{},handler:function(t,n){if(t&&e(n)){t.toString();this._handlers[t]=n}else if(r(n)){t.toString();this._handlers[t]=function(){this.transition(n)}}return this},"default":function(t){return"function"==typeof t&&(this._default=t),this},onEnter:function(t){return"function"==typeof t&&(this._enter=t),this},onExit:function(t){return"function"==typeof t&&(this._exit=t),this},getName:function(){return this.name},toString:function(){return"cellule state: "+this.getName()}}},createInput:function(t){if(!i(t))throw new TypeError("Input name must be a string");return new function(){this._name=t,this.activate=function(t){return this._validate&&!this._validate(t)?null:(this._transform&&(t=this._transform(t)),{input:this._name,msg:t})},this.getName=function(){return this._name},this.toString=function(){return this.getName()},this.validateMsg=function(t){return e(t)&&(this._validate=t),this},this.transformMsg=function(t){return e(t)&&(this._transform=t),this}}}};t=o});