!function(t,n){"function"==typeof define&&define.amd?define(function(){return n(t)}):"object"==typeof module&&module.exports?module.exports=n(this):t.cellule=n(t)}(this,function(t,n){var e=function(t){return"object"==typeof t},r=function(t){return"function"==typeof t},i=function(t){return"string"==typeof t||t instanceof String},u=function(t){return e(t)&&e(t._handlers)},o=function(t){return e(t)&&t._name&&r(t.activate)},a={createFsm:function(t){var e={};if(r(t)){e._inputs=[];var s=function(t){return a.createInput(t)},f=function(t){i(t)?e._inputs.push(s(t)):o(t)&&e._inputs.push(t)};e.addInput=function(t){return t!==n&&(Array.isArray(t)?t.forEach(function(t){f(t)}):f(t)),t},e.addInputs=e.addInput,t.apply(e),e.on={},e._inputs.forEach(function(t){if(e.on[t.getName]!==n)throw new Error("Cannot install the same input twice");e.on[t.getName()]=function(){var n=t;return function(t){var r=n.activate(t);return e.input(r.input,r.msg)}}()}),delete e._inputs,delete e.addInput}else u(t)&&(e.initialState=t);if(u(e.initialState)?e._currentState=e.initialState:e._currentState=null,e.input!==n)throw new Error("Cannot redefine input property on the fsm");if(e.transition!==n)throw new Error("Cannot redefine transition property on the fsm");return e.input=function(t,e){if(!this._currentState)return n;var i=this._currentState._handlers[t],u=this._currentState._default;return r(i)?i.call(this,e):r(u)?u.call(this,e):void 0},e.transition=function(t){if(!u(t))throw new Error("Must provide a state object to transition to");var n=this._currentState;this._currentState=t,r(n._exit)&&n._exit.call(this,t),r(t._enter)&&t._enter.call(this,n)},e.getCurrentState=function(){return this._currentState},e},createState:function(t){return{name:t,_handlers:{},handler:function(t,n){if(t&&r(n)){t.toString();this._handlers[t]=n}else if(u(n)){t.toString();this._handlers[t]=function(){this.transition(n)}}return this},"default":function(t){return"function"==typeof t&&(this._default=t),this},onEnter:function(t){return"function"==typeof t&&(this._enter=t),this},onExit:function(t){return"function"==typeof t&&(this._exit=t),this},getName:function(){return this.name},toString:function(){return"cellule state: "+this.getName()}}},createInput:function(t){if(!i(t))throw new TypeError("Input name must be a string");return new function(){this._name=t,this.activate=function(t){return this._validate&&!this._validate(t)?null:(this._transform&&(t=this._transform(t)),{input:this._name,msg:t})},this.getName=function(){return this._name},this.toString=function(){return this.getName()},this.validator=function(t){return r(t)&&(this._validate=t),this},this.transformer=function(t){return r(t)&&(this._transform=t),this}}}};return a});